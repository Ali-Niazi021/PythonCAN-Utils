# PythonCAN-Utils Web Backend

**Modern web-based CAN communication tool with Python backend and future web frontend**

This project transforms the Python GUI application into a scalable web-based solution with:
- **Python FastAPI Backend** - RESTful API + WebSocket for real-time CAN communication
- **Web Frontend** (Coming Soon) - Modern browser-based UI
- **PCAN & CANable Support** - Works with both device types
- **DBC File Support** - Automatic message decoding

---

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Web Frontend (Future)                    â”‚
â”‚                   React / Vue / Vanilla JS                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  HTTP REST API              WebSocket Streaming              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚  â€¢ Device Control           â€¢ Real-time Messages             â”‚
â”‚  â€¢ Message Send             â€¢ Auto-broadcast                 â”‚
â”‚  â€¢ DBC Management           â€¢ Low latency                    â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Python Backend (Current)                 â”‚
â”‚                         FastAPI + uvicorn                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  PCAN Driver                 CANable Driver                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚  â€¢ python-can                â€¢ python-can                    â”‚
â”‚  â€¢ PCAN API                  â€¢ gs_usb / libusb               â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â–¼                              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   PCAN   â”‚                  â”‚   CANable    â”‚
  â”‚   USB    â”‚                  â”‚  (gs_usb)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Current Status

### âœ… Completed: Python Backend

The Python backend is **fully functional** and ready to use:

- âœ… FastAPI REST API with full CRUD operations
- âœ… WebSocket real-time message streaming
- âœ… PCAN device support
- âœ… CANable device support (gs_usb/candleLight)
- âœ… DBC file loading and automatic decoding
- âœ… Device enumeration and management
- âœ… Message statistics and monitoring
- âœ… CORS enabled for web frontend
- âœ… Auto-generated API documentation (Swagger/ReDoc)
- âœ… Comprehensive test suite

### ğŸš§ Coming Next: Web Frontend

The web frontend will be built separately and communicate with this backend via:
- REST API for control operations
- WebSocket for real-time CAN message streaming

---

## ğŸš€ Quick Start

### Prerequisites

- Python 3.8 or higher
- PCAN-USB adapter (optional, if using PCAN)
- CANable adapter with candleLight firmware (optional, if using CANable)
- Windows: `libusb-1.0.dll` for CANable support
- Linux: USB permissions for CANable

### Installation

1. **Clone the repository**
   ```bash
   cd webserver/backend
   ```

2. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

3. **Windows: Install libusb for CANable**
   - Download libusb from https://libusb.info/
   - Place `libusb-1.0.dll` in project root

4. **Linux: Setup USB permissions for CANable**
   ```bash
   sudo usermod -a -G plugdev $USER
   # Logout and login for changes to take effect
   ```

### Running the Backend

#### Option 1: Using startup scripts (recommended)

**Windows:**
```bash
start.bat
```

**Linux/Mac:**
```bash
chmod +x start.sh
./start.sh
```

#### Option 2: Direct execution

```bash
python api.py
```

#### Option 3: Using uvicorn

```bash
uvicorn api:app --reload --host 0.0.0.0 --port 8000
```

### Accessing the Backend

Once running:
- **API Root**: http://localhost:8000
- **Interactive Docs**: http://localhost:8000/docs (Swagger UI)
- **Alternative Docs**: http://localhost:8000/redoc
- **WebSocket**: ws://localhost:8000/ws/can

---

## ğŸ“š API Documentation

### Key Endpoints

#### Device Management

- `GET /devices` - List available CAN devices
- `POST /connect` - Connect to a device
- `POST /disconnect` - Disconnect from device
- `GET /status` - Get connection status

#### Message Operations

- `POST /send` - Send a CAN message
- `GET /stats` - Get message statistics
- `WS /ws/can` - WebSocket for real-time messages

#### DBC Support

- `POST /dbc/load` - Load a DBC file
- `GET /dbc/messages` - Get messages from DBC

See [backend/README.md](webserver/backend/README.md) for complete API documentation.

---

## ğŸ§ª Testing

### Test the REST API

```bash
cd webserver/backend
python test_api.py
```

Interactive mode:
```bash
python test_api.py --interactive
```

### Test WebSocket Streaming

```bash
python test_websocket.py
```

### Manual Testing with curl

```bash
# Get devices
curl http://localhost:8000/devices

# Connect
curl -X POST http://localhost:8000/connect \
  -H "Content-Type: application/json" \
  -d '{"device_type":"pcan","channel":"USB1","baudrate":"BAUD_500K"}'

# Send message
curl -X POST http://localhost:8000/send \
  -H "Content-Type: application/json" \
  -d '{"can_id":291,"data":[1,2,3,4,5,6,7,8]}'
```

---

## ğŸ”§ Configuration

Configuration options can be set via environment variables:

```bash
# Server
HOST=0.0.0.0
PORT=8000
RELOAD=True

# CORS (configure for production)
CORS_ORIGINS=http://localhost:3000

# Logging
LOG_LEVEL=info
```

---

## ğŸ³ Docker Deployment (Optional)

A Dockerfile is provided for containerized deployment:

```bash
docker build -t can-backend .
docker run -p 8000:8000 --privileged can-backend
```

Note: `--privileged` flag is needed for USB device access.

---

## ğŸ“ Project Structure

```
webserver/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ api.py                 # Main FastAPI application
â”‚   â”œâ”€â”€ utils.py               # Utility functions
â”‚   â”œâ”€â”€ requirements.txt       # Python dependencies
â”‚   â”œâ”€â”€ README.md              # Backend documentation
â”‚   â”œâ”€â”€ start.bat              # Windows startup script
â”‚   â”œâ”€â”€ start.sh               # Linux/Mac startup script
â”‚   â”œâ”€â”€ test_api.py            # REST API test suite
â”‚   â””â”€â”€ test_websocket.py      # WebSocket test client
â”‚
â””â”€â”€ frontend/                  # Future web frontend
    â””â”€â”€ (Coming soon)
```

---

## ğŸŒ Frontend Development (Next Steps)

The backend is ready for frontend integration. Recommended approaches:

### Option 1: React Frontend
```bash
cd webserver/frontend
npx create-react-app can-explorer
cd can-explorer
npm install axios
```

### Option 2: Vue Frontend
```bash
cd webserver/frontend
npm create vue@latest
```

### Option 3: Vanilla JavaScript
Create a simple `index.html` with WebSocket and fetch API

### Frontend Requirements
- Connect to REST API at `http://localhost:8000`
- Subscribe to WebSocket at `ws://localhost:8000/ws/can`
- Handle real-time message display
- Provide UI for device control and message sending

---

## ğŸ” Troubleshooting

### Backend won't start
- Check Python version: `python --version` (need 3.8+)
- Verify dependencies: `pip install -r requirements.txt`
- Check port 8000 is available

### Can't connect to PCAN
- Install PCAN driver from PEAK System
- Verify device in Device Manager (Windows)
- Check `python-can` installation

### Can't connect to CANable
- Ensure candleLight firmware is flashed
- Windows: Place `libusb-1.0.dll` in project root
- Linux: Check USB permissions and udev rules
- Verify with `lsusb` (Linux) or Device Manager (Windows)

### WebSocket disconnects
- Check CORS settings in production
- Verify firewall allows WebSocket connections
- Check backend logs for errors

---

## ğŸ“ Development Roadmap

- [x] Python backend with REST API
- [x] WebSocket real-time streaming
- [x] PCAN driver integration
- [x] CANable driver integration
- [x] DBC file support
- [x] Comprehensive testing suite
- [ ] Web frontend (React/Vue/Vanilla)
- [ ] User authentication (optional)
- [ ] Database for message logging
- [ ] Advanced filtering and search
- [ ] Export to CSV/Excel
- [ ] Multi-user support
- [ ] Docker deployment guide

---

## ğŸ“„ License

See [LICENSE](../LICENSE) file in project root.

---

## ğŸ¤ Contributing

Contributions are welcome! The immediate need is:

1. **Web Frontend** - Build a modern UI to replace the Python GUI
2. **Testing** - Additional test coverage
3. **Documentation** - Expand API examples
4. **Features** - Message filtering, advanced statistics, etc.

---

## ğŸ“§ Support

For issues or questions:
- Open an issue on GitHub
- Check existing documentation
- Review test scripts for usage examples

---

**Status**: Backend âœ… Complete | Frontend ğŸš§ Coming Soon

The Python backend is production-ready and waiting for a web frontend!
